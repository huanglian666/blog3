import{_ as n,o as s,c as a,f as t}from"./app.3adea723.js";const p={},e=t(`<h2 id="\u4E00\u3001\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#\u4E00\u3001\u7B80\u4ECB" aria-hidden="true">#</a> \u4E00\u3001\u7B80\u4ECB</h2><blockquote><p>\u5728\u9879\u76EE\u4E2D\uFF0C\u6587\u4EF6\u7684\u4E0A\u4F20\u662F\u5E38\u89C1\u7684\u529F\u80FD\u3002\u5F88\u591A\u7A0B\u5E8F\u6216\u8005\u8F6F\u4EF6\u4E2D\u90FD\u7ECF\u5E38\u4F7F\u7528\u5230\u6587\u4EF6\u7684\u4E0A\u4F20\u3002</p><ul><li>\u90AE\u7BB1\u4E2D\u6709\u9644\u4EF6\u7684\u4E0A\u4F20\uFF1B</li><li>\u56FE\u7247\u4E0A\u4F20\u3002</li></ul></blockquote><h2 id="\u4E8C\u3001\u4EC0\u4E48\u662F\u6587\u4EF6\u4E0A\u4F20" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001\u4EC0\u4E48\u662F\u6587\u4EF6\u4E0A\u4F20" aria-hidden="true">#</a> \u4E8C\u3001\u4EC0\u4E48\u662F\u6587\u4EF6\u4E0A\u4F20</h2><blockquote><p>\u5F53\u7528\u6237\u5728\u524D\u7AEF\u9875\u9762\u70B9\u51FB\u6587\u4EF6\u4E0A\u4F20\u540E\uFF0C\u7528\u6237\u4E0A\u4F20\u7684\u6587\u4EF6\u6570\u636E\u63D0\u4EA4\u7ED9\u670D\u52A1\u5668\u7AEF\uFF0C\u5B9E\u73B0\u4FDD\u5B58\u3002</p></blockquote><h2 id="\u4E09\u3001\u4E0A\u4F20\u7684\u76F8\u5173\u9650\u5236" tabindex="-1"><a class="header-anchor" href="#\u4E09\u3001\u4E0A\u4F20\u7684\u76F8\u5173\u9650\u5236" aria-hidden="true">#</a> \u4E09\u3001\u4E0A\u4F20\u7684\u76F8\u5173\u9650\u5236</h2><h3 id="_3-1\u3001\u4E0A\u4F20\u5BF9\u8868\u5355\u7684\u9650\u5236" tabindex="-1"><a class="header-anchor" href="#_3-1\u3001\u4E0A\u4F20\u5BF9\u8868\u5355\u7684\u9650\u5236" aria-hidden="true">#</a> 3.1\u3001\u4E0A\u4F20\u5BF9\u8868\u5355\u7684\u9650\u5236</h3><blockquote><ul><li><code>method=&quot;post&quot;</code>\uFF1B</li><li><code>enctype=&quot;multipart/form-data&quot;</code>\uFF1B</li><li>\u8868\u5355\u4E2D\u9700\u8981\u6DFB\u52A0\u6587\u4EF6\u8868\u5355\u9879\uFF1A<code> &lt;input type=&quot;file&quot; name=&quot;xxx&quot; /&gt;</code></li></ul></blockquote><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xxx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  \u7528\u6237\u540D\uFF1B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
  \u7167\u3000\u7247\uFF1A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>photo<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>\u4E0A\u4F20<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2\u3001\u4E0A\u4F20\u5BF9servlet\u7684\u9650\u5236" tabindex="-1"><a class="header-anchor" href="#_3-2\u3001\u4E0A\u4F20\u5BF9servlet\u7684\u9650\u5236" aria-hidden="true">#</a> 3.2\u3001\u4E0A\u4F20\u5BF9Servlet\u7684\u9650\u5236</h3><blockquote><p><code>request.getParameter(&quot;xxx&quot;)</code>\u8FD9\u4E2A\u65B9\u6CD5\u5728\u8868\u5355\u4E3A<code>enctype=&quot;multipart/form-data&quot;</code>\u65F6\uFF0C\u5B83\u4F5C\u5E9F\u4E86\uFF0C\u5B83\u6C38\u8FDC\u90FD\u8FD4\u56DE<code>null</code>\u3002</p></blockquote><h3 id="_3-3\u3001\u5982\u4F55\u5B9E\u73B0\u6587\u4EF6\u4E0A\u4F20" tabindex="-1"><a class="header-anchor" href="#_3-3\u3001\u5982\u4F55\u5B9E\u73B0\u6587\u4EF6\u4E0A\u4F20" aria-hidden="true">#</a> 3.3\u3001\u5982\u4F55\u5B9E\u73B0\u6587\u4EF6\u4E0A\u4F20</h3><h4 id="_3-3-1\u3001\u76F8\u5173jar\u5305" tabindex="-1"><a class="header-anchor" href="#_3-3-1\u3001\u76F8\u5173jar\u5305" aria-hidden="true">#</a> 3.3.1\u3001\u76F8\u5173Jar\u5305</h4><blockquote><ul><li>commons-fileupload-1.4.jar</li><li>commons-io-2.2.jar</li></ul><p>\u5B83\u4F1A\u5E2E\u6211\u4EEC\u89E3\u6790request\u4E2D\u7684\u4E0A\u4F20\u6570\u636E\uFF0C\u89E3\u6790\u540E\u7684\u7ED3\u679C\u662F\u4E00\u4E2A\u8868\u5355\u9879\u6570\u636E\u5C01\u88C5\u5230\u4E00\u4E2AFileItem\u5BF9\u8C61\u4E2D\u3002\u6211\u4EEC\u53EA\u9700\u8981\u8C03\u7528FileItem\u7684\u65B9\u6CD5\u5373\u53EF\u3002</p></blockquote><h4 id="_3-3-2\u3001\u5177\u4F53\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#_3-3-2\u3001\u5177\u4F53\u6B65\u9AA4" aria-hidden="true">#</a> 3.3.2\u3001\u5177\u4F53\u6B65\u9AA4</h4><blockquote><ol><li><p>\u521B\u5EFA\u5DE5\u5382\uFF1A<code>DiskFileItemFactory factory = new DiskFileItemFactory()</code>\uFF1B</p></li><li><p>\u521B\u5EFA\u89E3\u6790\u5668\uFF1A<code>ServletFileUpload sfu = new ServletFileUpload(factory)</code>\uFF1B</p></li><li><p>\u4F7F\u7528\u89E3\u6790\u5668\u6765\u89E3\u6790<code>request</code>\uFF0C\u5F97\u5230<code>FileItem</code>\u96C6\u5408\uFF1A</p><p><code>List&lt;FileItem&gt; fileItemList = sfu.parseRequest(request)</code>\uFF0C</p><p><code>FileItem</code>\u4E2D\u5E38\u7528\u65B9\u6CD5\uFF1A</p><ul><li><code>boolean isFormField()</code>\uFF1A\u662F\u5426\u4E3A\u666E\u901A\u8868\u5355\u9879\uFF01\u8FD4\u56DEtrue\u4E3A\u666E\u901A\u8868\u5355\u9879\uFF0C\u5982\u679C\u4E3Afalse\u5373\u6587\u4EF6\u8868\u5355\u9879</li><li><code>String getFieldName()</code>\uFF1A\u8FD4\u56DE\u5F53\u524D\u8868\u5355\u9879\u7684\u540D\u79F0\uFF1B</li><li><code>String getString(String charset)</code>\uFF1A\u8FD4\u56DE\u8868\u5355\u9879\u7684\u503C\uFF1B</li><li><code>String getName()</code>\uFF1A\u8FD4\u56DE\u4E0A\u4F20\u7684\u6587\u4EF6\u540D\u79F0\uFF1B</li><li><code>long getSize()</code>\uFF1A\u8FD4\u56DE\u4E0A\u4F20\u6587\u4EF6\u7684\u5B57\u8282\u6570\uFF1B</li><li><code>InputStream getInputStream()</code>\uFF1A\u8FD4\u56DE\u4E0A\u4F20\u6587\u4EF6\u5BF9\u5E94\u7684\u8F93\u5165\u6D41\uFF1B</li><li><code>void write(File destFile)</code>\uFF1A\u628A\u4E0A\u4F20\u7684\u6587\u4EF6\u5185\u5BB9\u4FDD\u5B58\u5230\u6307\u5B9A\u7684\u6587\u4EF6\u4E2D\u3002</li></ul></li></ol></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u521B\u5EFA\u5DE5\u5382</span>
<span class="token class-name">DiskFileItemFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DiskFileItemFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u521B\u5EFA\u89E3\u6790\u5668</span>
<span class="token class-name">ServletFileUpload</span> sfu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletFileUpload</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u4F7F\u7528\u89E3\u6790\u5668\u6765\u89E3\u6790request\uFF0C\u5F97\u5230FileItem\u96C6\u5408</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileItem</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> sfu<span class="token punctuation">.</span><span class="token function">parseRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FileItem</span> item <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">isFormField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> fieldName <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fieldName <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> fileName <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> size <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6587\u4EF6\u540D\uFF1A&quot;</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6587\u4EF6\u5927\u5C0F&quot;</span> <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token class-name">ServletContext</span> servletContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> realPath <span class="token operator">=</span> servletContext<span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">&quot;/img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            item<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>realPath <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileUploadException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4\u3001\u9700\u8981\u6CE8\u610F\u7684\u7EC6\u8282" tabindex="-1"><a class="header-anchor" href="#_3-4\u3001\u9700\u8981\u6CE8\u610F\u7684\u7EC6\u8282" aria-hidden="true">#</a> 3.4\u3001\u9700\u8981\u6CE8\u610F\u7684\u7EC6\u8282</h3><h4 id="_3-4-1\u3001\u6587\u4EF6\u540D\u6216\u666E\u901A\u8868\u5355\u9879\u4E71\u7801" tabindex="-1"><a class="header-anchor" href="#_3-4-1\u3001\u6587\u4EF6\u540D\u6216\u666E\u901A\u8868\u5355\u9879\u4E71\u7801" aria-hidden="true">#</a> 3.4.1\u3001\u6587\u4EF6\u540D\u6216\u666E\u901A\u8868\u5355\u9879\u4E71\u7801</h4><blockquote><p>\u5982\u4F55\u89E3\u51B3\uFF1A</p><ul><li><code>request.setCharacterEncoding(&quot;utf-8&quot;);</code></li><li><code>servletFileUpload.setHeaderEncoding(&quot;utf-8&quot;);</code></li></ul><p>\u4EE5\u4E0A\u4E24\u4E2A\u65B9\u6848\u4E8C\u9009\u4E00</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u521B\u5EFA\u5DE5\u5382</span>
<span class="token class-name">DiskFileItemFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DiskFileItemFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u521B\u5EFA\u89E3\u6790\u5668</span>
<span class="token class-name">ServletFileUpload</span> sfu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletFileUpload</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//sfu.setHeaderEncoding(&quot;utf-8&quot;);</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u4F7F\u7528\u89E3\u6790\u5668\u6765\u89E3\u6790request\uFF0C\u5F97\u5230FileItem\u96C6\u5408</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileItem</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> sfu<span class="token punctuation">.</span><span class="token function">parseRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FileItem</span> item <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">isFormField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> fieldName <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fieldName <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> fileName <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> size <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6587\u4EF6\u540D\uFF1A&quot;</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6587\u4EF6\u5927\u5C0F&quot;</span> <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token class-name">ServletContext</span> servletContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> realPath <span class="token operator">=</span> servletContext<span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">&quot;/img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            item<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>realPath <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileUploadException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-4-2\u3001\u540C\u540D\u6587\u4EF6\u4E0A\u4F20\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_3-4-2\u3001\u540C\u540D\u6587\u4EF6\u4E0A\u4F20\u95EE\u9898" aria-hidden="true">#</a> 3.4.2\u3001\u540C\u540D\u6587\u4EF6\u4E0A\u4F20\u95EE\u9898</h4><blockquote><p>\u4F7F\u7528UUID\uFF1A<code>fileName = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;&quot;) + &quot;_&quot; + fileName;</code></p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u521B\u5EFA\u5DE5\u5382</span>
<span class="token class-name">DiskFileItemFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DiskFileItemFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u521B\u5EFA\u89E3\u6790\u5668</span>
<span class="token class-name">ServletFileUpload</span> sfu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletFileUpload</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//sfu.setHeaderEncoding(&quot;utf-8&quot;);</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u4F7F\u7528\u89E3\u6790\u5668\u6765\u89E3\u6790request\uFF0C\u5F97\u5230FileItem\u96C6\u5408</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileItem</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> sfu<span class="token punctuation">.</span><span class="token function">parseRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FileItem</span> item <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">isFormField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> fieldName <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getFieldName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fieldName <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> fileName <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> size <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6587\u4EF6\u540D\uFF1A&quot;</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6587\u4EF6\u5927\u5C0F&quot;</span> <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token class-name">ServletContext</span> servletContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getServletConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> realPath <span class="token operator">=</span> servletContext<span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">&quot;/img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            item<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>realPath <span class="token operator">+</span> 
                                <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> 
                                <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> 
                                <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> 
                                fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileUploadException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,23),o=[e];function c(l,u){return s(),a("div",null,o)}const k=n(p,[["render",c],["__file","06_\u6587\u4EF6\u4E0A\u4F20.html.vue"]]);export{k as default};
