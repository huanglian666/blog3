import{_ as c,r as o,o as l,c as i,a as s,b as n,d as e,e as p,f as a}from"./app.3adea723.js";const u="/blog3/assets/image-20201028065801447.96e74356.png",r="/blog3/assets/image-20201028070254466.70c798fa.png",k="/blog3/assets/image-20201026212724471.fd206e58.png",d="/blog3/assets/image-20201026211604752.192e5a19.png",m="/blog3/assets/image-20201028011759647.f2939c8f.png",v="/blog3/assets/image-20210818151658886.093fbd1c.png",b="/blog3/assets/image-20210818152033383.8e1fc3e2.png",g="/blog3/assets/image-20210818154909349.c5797a9e.png",h="/blog3/assets/image-20210818162733409.f94b3771.png",y="/blog3/assets/image-20210511143751814.82d82842.png",w="/blog3/assets/image-20210511143828389.313aff77.png",f="/blog3/assets/image-20210511143952611.8a871130.png",q="/blog3/assets/image-20210511144042065.94cfd4e6.png",S="/blog3/assets/image-20210511144142075.110d78ce.png",x="/blog3/assets/image-20210511144232989.299cf1b7.png",R="/blog3/assets/image-20210511144307280.d6f547a9.png",_="/blog3/assets/image-20210818165013642.096562e1.png",P="/blog3/assets/image-20210818165552976.d97d022a.png",D="/blog3/assets/image-20210818170718455.5e6039a5.png",I="/blog3/assets/image-20210818172601364.d2b57d8c.png",F="/blog3/assets/image-20201028050506550.d3a1bfab.png",j="/blog3/assets/image-20210201214231216.fba316ca.png",E="/blog3/assets/image-20210329230935856.7aec8fe6.png",O="/blog3/assets/image-20210819105935516.05b02c24.png",L="/blog3/assets/image-20210819113541440.6050c268.png",H="/blog3/assets/image-20210511163229443.e71147b7.png",N="/blog3/assets/image-20210819140928599.c0811b61.png",C="/blog3/assets/image-20210819141742327.8d8be912.png",M="/blog3/assets/image-20210330163338800.7651d994.png",T="/blog3/assets/image-20210819143451408.6b21007b.png",A="/blog3/assets/image-20201029094519063.9747adb6.png",W="/blog3/assets/image-20210331105236701.7176ec99.png",$="/blog3/assets/q.8dfa91cc.png",B="/blog3/assets/image-20201028204618786.1d2feb07.png",J="/blog3/assets/image-20201028210839167.b0539b35.png",Q={},U=a('<h1 id="\u4E00-sentinel\u670D\u52A1\u54E8\u5175\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#\u4E00-sentinel\u670D\u52A1\u54E8\u5175\u7B80\u4ECB" aria-hidden="true">#</a> \u4E00\uFF1ASentinel\u670D\u52A1\u54E8\u5175\u7B80\u4ECB</h1><p>\u5C0F\u7ED3\uFF1A</p><blockquote><p>1\uFF1A\u6CE8\u518C\u4E2D\u5FC3\uFF08nacos\uFF09\uFF0C\u5B9E\u73B0\u670D\u52A1\u7684\u6CE8\u518C\u4E0E\u53D1\u73B0</p><p>2\uFF1ARibbon\uFF0C\u5BA2\u6237\u7AEF\u7684\u8D1F\u8F7D\u5747\u8861\u5668\uFF0C\u89E3\u51B3\u670D\u52A1\u96C6\u7FA4\u7684\u8D1F\u8F7D\u5747\u8861</p><p>3\uFF1AOpenfeign\uFF0C\u58F0\u660E\u5F0F\u7684http\u5BA2\u6237\u7AEF\uFF0C\u670D\u52A1\u95F4\u8FDC\u7A0B\u8C03\u7528\uFF0C\u5E76\u901A\u8FC7ribbon\u5B9E\u73B0\u8D1F\u8F7D\u5747\u8861</p><p>4\uFF1A\u914D\u7F6E\u4E2D\u5FC3\uFF08nacos\uFF09\uFF0C\u914D\u7F6E\u4FE1\u606F\u4E2D\u5FC3\u5316\u7BA1\u7406\uFF0C\u5171\u4EAB\u914D\u7F6E\uFF0C\u652F\u6301\u52A8\u6001\u5237\u65B0</p><p>5\uFF1ASentinel</p></blockquote><p>\u4E2D\u6587\u6587\u6863\uFF1Ahttps://github.com/alibaba/Sentinel/wiki</p><p>\u4E0B\u8F7D\u5730\u5740\uFF1Ahttps://github.com/alibaba/Sentinel/releases</p><h2 id="_1-0-\u670D\u52A1\u96EA\u5D29\u6548\u5E94" tabindex="-1"><a class="header-anchor" href="#_1-0-\u670D\u52A1\u96EA\u5D29\u6548\u5E94" aria-hidden="true">#</a> 1.0\uFF1A\u670D\u52A1\u96EA\u5D29\u6548\u5E94</h2><blockquote><p>\u7EA7\u8054\u5931\u6548\u3001\u7EA7\u8054\u6545\u969C\u3001cascading failure</p></blockquote><p><img src="'+u+'" alt="image-20201028065801447"></p><p>\u89E3\u51B3\u529E\u6CD5</p><p>1\uFF1A\u9650\u6D41</p><p>2\uFF1A\u4ED3\u58C1\u6A21\u5F0F</p><p><img src="'+r+'" alt="image-20201028070254466"></p><p>3\uFF1A\u65AD\u8DEF\u5668</p><h2 id="_1-1-sentinel\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_1-1-sentinel\u662F\u4EC0\u4E48" aria-hidden="true">#</a> 1.1\uFF1ASentinel\u662F\u4EC0\u4E48</h2><blockquote><p>\u968F\u7740\u5FAE\u670D\u52A1\u7684\u6D41\u884C\uFF0C\u670D\u52A1\u548C\u670D\u52A1\u4E4B\u95F4\u7684\u7A33\u5B9A\u6027\u53D8\u5F97\u8D8A\u6765\u8D8A\u91CD\u8981\u3002Sentinel \u4EE5\u6D41\u91CF\u4E3A\u5207\u5165\u70B9\uFF0C\u4ECE\u6D41\u91CF\u63A7\u5236\u3001\u7194\u65AD\u964D\u7EA7\u3001\u7CFB\u7EDF\u8D1F\u8F7D\u4FDD\u62A4\u7B49\u591A\u4E2A\u7EF4\u5EA6\u4FDD\u62A4\u670D\u52A1\u7684\u7A33\u5B9A\u6027\u3002</p></blockquote><h3 id="_1-1-1-sentinel-\u5177\u6709\u4EE5\u4E0B\u7279\u5F81" tabindex="-1"><a class="header-anchor" href="#_1-1-1-sentinel-\u5177\u6709\u4EE5\u4E0B\u7279\u5F81" aria-hidden="true">#</a> 1.1.1\uFF1ASentinel \u5177\u6709\u4EE5\u4E0B\u7279\u5F81</h3><ul><li><p><strong>\u4E30\u5BCC\u7684\u5E94\u7528\u573A\u666F</strong>\uFF1ASentinel \u627F\u63A5\u4E86\u963F\u91CC\u5DF4\u5DF4\u8FD1 10 \u5E74\u7684\u53CC\u5341\u4E00\u5927\u4FC3\u6D41\u91CF\u7684\u6838\u5FC3\u573A\u666F\uFF0C\u4F8B\u5982\u79D2\u6740\uFF08\u5373\u7A81\u53D1\u6D41\u91CF\u63A7\u5236\u5728\u7CFB\u7EDF\u5BB9\u91CF\u53EF\u4EE5\u627F\u53D7\u7684\u8303\u56F4\uFF09\u3001\u6D88\u606F\u524A\u5CF0\u586B\u8C37\u3001\u96C6\u7FA4\u6D41\u91CF\u63A7\u5236\u3001\u5B9E\u65F6\u7194\u65AD\u4E0B\u6E38\u4E0D\u53EF\u7528\u5E94\u7528\u7B49\u3002</p><p><img src="'+k+'" alt="image-20201026212724471"></p></li><li><p><strong>\u5B8C\u5907\u7684\u5B9E\u65F6\u76D1\u63A7</strong>\uFF1ASentinel \u540C\u65F6\u63D0\u4F9B\u5B9E\u65F6\u7684\u76D1\u63A7\u529F\u80FD\u3002\u60A8\u53EF\u4EE5\u5728\u63A7\u5236\u53F0\u4E2D\u770B\u5230\u63A5\u5165\u5E94\u7528\u7684\u5355\u53F0\u673A\u5668\u79D2\u7EA7\u6570\u636E\uFF0C\u751A\u81F3 500 \u53F0\u4EE5\u4E0B\u89C4\u6A21\u7684\u96C6\u7FA4\u7684\u6C47\u603B\u8FD0\u884C\u60C5\u51B5\u3002</p></li><li><p><strong>\u5E7F\u6CDB\u7684\u5F00\u6E90\u751F\u6001</strong>\uFF1ASentinel \u63D0\u4F9B\u5F00\u7BB1\u5373\u7528\u7684\u4E0E\u5176\u5B83\u5F00\u6E90\u6846\u67B6/\u5E93\u7684\u6574\u5408\u6A21\u5757\uFF0C\u4F8B\u5982\u4E0E Spring Cloud\u3001Dubbo\u3001gRPC \u7684\u6574\u5408\u3002\u60A8\u53EA\u9700\u8981\u5F15\u5165\u76F8\u5E94\u7684\u4F9D\u8D56\u5E76\u8FDB\u884C\u7B80\u5355\u7684\u914D\u7F6E\u5373\u53EF\u5FEB\u901F\u5730\u63A5\u5165 Sentinel\u3002</p></li><li><p><strong>\u5B8C\u5584\u7684 SPI \u6269\u5C55\u70B9</strong>\uFF1ASentinel \u63D0\u4F9B\u7B80\u5355\u6613\u7528\u3001\u5B8C\u5584\u7684 SPI \u6269\u5C55\u63A5\u53E3\u3002\u60A8\u53EF\u4EE5\u901A\u8FC7\u5B9E\u73B0\u6269\u5C55\u63A5\u53E3\u6765\u5FEB\u901F\u5730\u5B9A\u5236\u903B\u8F91\u3002\u4F8B\u5982\u5B9A\u5236\u89C4\u5219\u7BA1\u7406\u3001\u9002\u914D\u52A8\u6001\u6570\u636E\u6E90\u7B49\u3002</p></li></ul><h3 id="_1-1-2-sentinel-\u5206\u4E3A\u4E24\u4E2A\u90E8\u5206" tabindex="-1"><a class="header-anchor" href="#_1-1-2-sentinel-\u5206\u4E3A\u4E24\u4E2A\u90E8\u5206" aria-hidden="true">#</a> 1.1.2\uFF1ASentinel \u5206\u4E3A\u4E24\u4E2A\u90E8\u5206:</h3><ul><li>**\u6838\u5FC3\u5E93\uFF08Java \u5BA2\u6237\u7AEF\uFF09**\u4E0D\u4F9D\u8D56\u4EFB\u4F55\u6846\u67B6/\u5E93\uFF0C\u80FD\u591F\u8FD0\u884C\u4E8E\u6240\u6709 Java \u8FD0\u884C\u65F6\u73AF\u5883\uFF0C\u540C\u65F6\u5BF9 Dubbo / Spring Cloud \u7B49\u6846\u67B6\u4E5F\u6709\u8F83\u597D\u7684\u652F\u6301\u3002</li><li>**\u63A7\u5236\u53F0\uFF08Dashboard\uFF09**\u57FA\u4E8E Spring Boot \u5F00\u53D1\uFF0C\u6253\u5305\u540E\u53EF\u4EE5\u76F4\u63A5\u8FD0\u884C\uFF0C\u4E0D\u9700\u8981\u989D\u5916\u7684 Tomcat \u7B49\u5E94\u7528\u5BB9\u5668\u3002</li></ul><h2 id="_1-2-sentinel\u4E0Ehystrix\u5BF9\u6BD4" tabindex="-1"><a class="header-anchor" href="#_1-2-sentinel\u4E0Ehystrix\u5BF9\u6BD4" aria-hidden="true">#</a> 1.2\uFF1ASentinel\u4E0EHystrix\u5BF9\u6BD4</h2><blockquote><p>Sentinel\u662F\u963F\u91CC\u5BF9hystrix\u7684\u66FF\u6362</p></blockquote><table><thead><tr><th style="text-align:left;"></th><th style="text-align:left;">Sentinel</th><th>Hystrix</th></tr></thead><tbody><tr><td style="text-align:left;">\u9694\u79BB\u7B56\u7565</td><td style="text-align:left;">\u4FE1\u53F7\u91CF\u9694\u79BB(\u5E76\u53D1\u7EBF\u7A0B\u6570)</td><td>\u7EBF\u7A0B\u6C60\u9694\u79BB/\u4FE1\u53F7\u91CF\u9694\u79BB</td></tr><tr><td style="text-align:left;">\u7194\u65AD\u964D\u7EA7\u7B56\u7565</td><td style="text-align:left;">\u6162\u8C03\u7528\u6BD4\u4F8B\u3001\u5F02\u5E38\u6BD4\u7387\u3001\u5F02\u5E38\u6570</td><td>\u5F02\u5E38\u6BD4\u7387</td></tr><tr><td style="text-align:left;">\u5B9E\u65F6\u6307\u6807\u5B9E\u73B0</td><td style="text-align:left;">\u6ED1\u52A8\u7A97\u53E3</td><td>\u6ED1\u52A8\u7A97\u53E3\uFF08\u57FA\u4E8E RxJava\uFF09</td></tr><tr><td style="text-align:left;">\u89C4\u5219\u914D\u7F6E(rule)</td><td style="text-align:left;">\u652F\u6301\u591A\u79CD\u6570\u636E\u6E90</td><td>\u652F\u6301\u591A\u79CD\u6570\u636E\u6E90</td></tr><tr><td style="text-align:left;">\u6269\u5C55\u6027</td><td style="text-align:left;">\u591A\u4E2A\u6269\u5C55\u70B9</td><td>\u63D2\u4EF6\u7684\u5F62\u5F0F</td></tr><tr><td style="text-align:left;">\u57FA\u4E8E\u6CE8\u89E3\u7684\u652F\u6301</td><td style="text-align:left;">\u652F\u6301</td><td>\u652F\u6301</td></tr><tr><td style="text-align:left;">\u8C03\u7528\u94FE\u8DEF\u4FE1\u606F</td><td style="text-align:left;">\u652F\u6301\u540C\u6B65\u8C03\u7528</td><td>\u4E0D\u652F\u6301</td></tr><tr><td style="text-align:left;">\u9650\u6D41QPS(query per second)</td><td style="text-align:left;">\u57FA\u4E8E QPS / \u5E76\u53D1\u6570\uFF0C\u652F\u6301\u57FA\u4E8E\u8C03\u7528\u5173\u7CFB\u7684\u9650\u6D41</td><td>\u4E0D\u652F\u6301</td></tr><tr><td style="text-align:left;">\u6D41\u91CF\u6574\u5F62</td><td style="text-align:left;">\u652F\u6301\u6162\u542F\u52A8\u3001\u5300\u901F\u5668\u6A21\u5F0F</td><td>\u4E0D\u652F\u6301</td></tr><tr><td style="text-align:left;">\u7CFB\u7EDF\u8D1F\u8F7D\u4FDD\u62A4</td><td style="text-align:left;">\u652F\u6301</td><td>\u4E0D\u652F\u6301</td></tr><tr><td style="text-align:left;">\u5B9E\u65F6\u76D1\u63A7 API</td><td style="text-align:left;">\u5404\u5F0F\u5404\u6837</td><td>\u8F83\u4E3A\u7B80\u5355</td></tr><tr><td style="text-align:left;">\u63A7\u5236\u53F0</td><td style="text-align:left;">\u5F00\u7BB1\u5373\u7528\uFF0C\u53EF\u914D\u7F6E\u89C4\u5219\u3001\u67E5\u770B\u79D2\u7EA7\u76D1\u63A7\u3001\u673A\u5668\u53D1\u73B0\u7B49</td><td>\u4E0D\u5B8C\u5584</td></tr><tr><td style="text-align:left;">\u5E38\u89C1\u6846\u67B6\u7684\u9002\u914D</td><td style="text-align:left;">Servlet\u3001Spring Cloud\u3001Dubbo\u3001gRPC \u7B49</td><td>Servlet\u3001Spring Cloud Netflix</td></tr></tbody></table><p><strong>Hystrix\u5DF2\u7ECF\u505C\u66F4\u8BF4\u660E</strong></p><p><img src="'+d+'" alt="image-20201026211604752"></p><h2 id="_1-3-sentinel\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#_1-3-sentinel\u67B6\u6784" aria-hidden="true">#</a> 1.3\uFF1ASentinel\u67B6\u6784</h2><p><img src="'+m+`" alt="image-20201028011759647"></p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#\u63A5\u53E3\u6982\u89C8</span>
<span class="token key attr-name">http</span><span class="token punctuation">:</span><span class="token value attr-value">//127.0.0.1:8720/api</span>
<span class="token comment">#\u83B7\u53D6\u8D44\u6E90\u7684metrics\u4FE1\u606F</span>
<span class="token key attr-name">http</span><span class="token punctuation">:</span><span class="token value attr-value">//127.0.0.1:8720/cnode?id=/jifen/{jifenId}</span>
<span class="token comment">#\u83B7\u53D6\u6D41\u63A7\u89C4\u5219\u63A5\u53E3</span>
<span class="token key attr-name">http</span><span class="token punctuation">:</span><span class="token value attr-value">//127.0.0.1:8720/getRules?type=flow</span>
<span class="token comment">#\u8BBE\u7F6E\u89C4\u5219\u63A5\u53E3</span>
<span class="token key attr-name">http</span><span class="token punctuation">:</span><span class="token value attr-value">//127.0.0.1:8720/setRules</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-4-sentinel\u63A7\u5236\u53F0\u5B89\u88C5" tabindex="-1"><a class="header-anchor" href="#_1-4-sentinel\u63A7\u5236\u53F0\u5B89\u88C5" aria-hidden="true">#</a> 1.4\uFF1ASentinel\u63A7\u5236\u53F0\u5B89\u88C5</h2><blockquote><p><strong>\u6CE8\u610F</strong>\uFF1A\u542F\u52A8 Sentinel \u63A7\u5236\u53F0\u9700\u8981 JDK \u7248\u672C\u4E3A 1.8 \u53CA\u4EE5\u4E0A\u7248\u672C\u3002</p><p>\u529F\u80FD</p><p>1\uFF1A\u5B9E\u65F6\u89C2\u770B\u6BCF\u4E2A\u8D44\u6E90\u7684\u8BBF\u95EE\u60C5\u51B5\uFF08qps\uFF09</p><p>2\uFF1A\u901A\u8FC7\u63A7\u5236\u53F0\uFF0C\u8BBE\u7F6E\u6D41\u63A7\u89C4\u5219\uFF08qps\u3001\u7EBF\u7A0B\u6570\uFF09\u3001\u8FD8\u53EF\u4EE5\u8BBE\u7F6E\u7194\u65AD\u964D\u7EA7\u7684\u89C4\u5219\uFF08\u6162\u8C03\u7528\u6BD4\u4F8B\u3001\u5F02\u5E38\u6BD4\u4F8B\u3001\u5F02\u5E38\u6570\uFF09</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">java</span>  <span class="token parameter variable">-jar</span> sentinel-dashboard-1.8.0.jar <span class="token parameter variable">--server.port</span><span class="token operator">=</span><span class="token number">8888</span>
pause
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-5-\u5FAE\u670D\u52A1\u6574\u5408sentinel" tabindex="-1"><a class="header-anchor" href="#_1-5-\u5FAE\u670D\u52A1\u6574\u5408sentinel" aria-hidden="true">#</a> 1.5\uFF1A\u5FAE\u670D\u52A1\u6574\u5408Sentinel</h2><p>\u7B2C\u4E00\u6B65\uFF1A\u6DFB\u52A0\u4F9D\u8D56</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+v+`" alt="image-20210818151658886"></p><p>\u7B2C\u4E8C\u6B65\uFF1A\u914D\u7F6E</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#\u9ED8\u8BA4\u662F8719\uFF0C\u5982\u679C8719\u88AB\u5360\u7528 +1\uFF0C\u4E00\u76F4\u5230\u6CA1\u6709\u88AB\u5360\u7528</span>
<span class="token key attr-name">spring.cloud.sentinel.transport.port</span><span class="token punctuation">=</span><span class="token value attr-value">8719</span>
<span class="token key attr-name">spring.cloud.sentinel.transport.dashboard</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:8888</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#\u5F00\u542F\u9965\u989D\u52A0\u8F7D\uFF0C\u5F53\u9879\u76EE\u542F\u52A8\u7ACB\u5373\u5B8C\u6210\u521D\u59CB\u5316\uFF0C\u9ED8\u8BA4\u662F\u61D2\u52A0\u8F7D</span>
<span class="token key attr-name">spring.cloud.sentinel.eager</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+b+`" alt="image-20210818152033383"></p><h1 id="\u4E8C-sentinel\u670D\u52A1\u6D41\u63A7" tabindex="-1"><a class="header-anchor" href="#\u4E8C-sentinel\u670D\u52A1\u6D41\u63A7" aria-hidden="true">#</a> \u4E8C\uFF1ASentinel\u670D\u52A1\u6D41\u63A7</h1><blockquote><p>Sentinel\u901A\u8FC7<strong>\u6D41\u91CF\u63A7\u5236</strong>\uFF08flow control\uFF09\u4EE5\u53CA<strong>\u7194\u65AD\u964D\u7EA7</strong>\u6765\u4FDD\u62A4\u7CFB\u7EDF\u8D44\u6E90</p></blockquote><h2 id="_2-1-qps\u8D85\u8FC7\u9608\u503C\u76F4\u63A5\u5931\u8D25" tabindex="-1"><a class="header-anchor" href="#_2-1-qps\u8D85\u8FC7\u9608\u503C\u76F4\u63A5\u5931\u8D25" aria-hidden="true">#</a> 2.1\uFF1AQPS\u8D85\u8FC7\u9608\u503C\u76F4\u63A5\u5931\u8D25</h2><blockquote><p><strong>\u6D41\u91CF\u63A7\u5236</strong>\uFF08flow control\uFF09\uFF0C\u5176\u539F\u7406\u662F\u76D1\u63A7\u5E94\u7528\u6D41\u91CF\u7684 QPS \u6216\u5E76\u53D1\u7EBF\u7A0B\u6570\u7B49\u6307\u6807\uFF0C\u5F53\u8FBE\u5230\u6307\u5B9A\u7684\u9608\u503C\u65F6\u5BF9\u6D41\u91CF\u8FDB\u884C\u63A7\u5236\uFF0C\u4EE5\u907F\u514D\u88AB\u77AC\u65F6\u7684\u6D41\u91CF\u9AD8\u5CF0\u51B2\u57AE\uFF0C\u4ECE\u800C\u4FDD\u969C\u5E94\u7528\u7684\u9AD8\u53EF\u7528\u6027\u3002</p></blockquote><div class="language-txt ext-txt line-numbers-mode"><pre class="language-txt"><code>QPS:Queries-per-second,\u6BCF\u79D2\u8D44\u6E90\u88AB\u8BBF\u95EE\u7684\u6B21\u6570
\u5F53\u88AB\u8BBF\u95EE\u8D44\u6E90\u7684QPS\u8D85\u8FC7\u9608\u503C\uFF0C\u76F4\u63A5\u8FDB\u884C\u9650\u6D41\uFF08\u9650\u5236\u8BBF\u95EE\uFF09\uFF0C\u4ECE\u800C\u4FDD\u62A4\u8D44\u6E90\uFF0C
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u89E6\u53D1\u6761\u4EF6\uFF1A/order/test5\u5F53qps&gt;1\u65F6\uFF0C\u4F1A\u89E6\u53D1\u6D41\u63A7</p></blockquote><p><img src="`+g+'" alt="image-20210818154909349"></p><h2 id="_2-2-\u7EBF\u7A0B\u6570\u8D85\u8FC7\u9608\u503C\u76F4\u63A5\u5931\u8D25" tabindex="-1"><a class="header-anchor" href="#_2-2-\u7EBF\u7A0B\u6570\u8D85\u8FC7\u9608\u503C\u76F4\u63A5\u5931\u8D25" aria-hidden="true">#</a> 2.2\uFF1A\u7EBF\u7A0B\u6570\u8D85\u8FC7\u9608\u503C\u76F4\u63A5\u5931\u8D25</h2><blockquote><p>\u89E6\u53D1\u6761\u4EF6\uFF1A\u5F53/order/test5 \u6B63\u5728\u5DE5\u4F5C\u7684\u7EBF\u7A0B\u6570&gt;1</p></blockquote><p><img src="'+h+'" alt="image-20210818162733409"></p><p>Jemeter\u4F7F\u7528\u6B65\u9AA4</p><p>1\uFF1A\u65B0\u5EFA\u6D4B\u8BD5\u8BA1\u5212</p><p><img src="'+y+'" alt="image-20210511143751814"></p><p>2\uFF1A\u6DFB\u52A0\u7EBF\u7A0B\u7EC4</p><p><img src="'+w+'" alt="image-20210511143828389"></p><p><img src="'+f+'" alt="image-20210511143952611"></p><p>3\uFF1A\u6DFB\u52A0http\u8BF7\u6C42</p><p><img src="'+q+'" alt="image-20210511144042065"></p><p><img src="'+S+'" alt="image-20210511144142075"></p><p>4\uFF1A\u6DFB\u52A0\u7ED3\u679C\u89C2\u5BDF</p><p><img src="'+x+'" alt="image-20210511144232989"></p><p>5\uFF1A\u53D1\u9001\u8BF7\u6C42</p><p><img src="'+R+'" alt="image-20210511144307280"></p><h2 id="_2-3-qps\u8D85\u8FC7\u9608\u503C\u5173\u8054\u5931\u8D25" tabindex="-1"><a class="header-anchor" href="#_2-3-qps\u8D85\u8FC7\u9608\u503C\u5173\u8054\u5931\u8D25" aria-hidden="true">#</a> 2.3\uFF1AQPS\u8D85\u8FC7\u9608\u503C\u5173\u8054\u5931\u8D25</h2><blockquote><p>\u89E6\u53D1\u6761\u4EF6\uFF1A\u5F53\u5173\u8054\u8D44\u6E90(/order/test6)\u8BBF\u95EEqps&gt;1 ,\u90A3\u4E48/order/test5 \u5C31\u4F1A\u88AB\u6D41\u63A7</p></blockquote><p><img src="'+_+'" alt="image-20210818165013642"></p><h2 id="_2-4-\u7EBF\u7A0B\u8D85\u8FC7\u9608\u503C\u5173\u8054\u5931\u8D25" tabindex="-1"><a class="header-anchor" href="#_2-4-\u7EBF\u7A0B\u8D85\u8FC7\u9608\u503C\u5173\u8054\u5931\u8D25" aria-hidden="true">#</a> 2.4\uFF1A\u7EBF\u7A0B\u8D85\u8FC7\u9608\u503C\u5173\u8054\u5931\u8D25</h2><blockquote><p>\u89E6\u53D1\u6761\u4EF6\uFF1A\u5F53\u5173\u8054\u8D44\u6E90(/order/test6)\u6B63\u5728\u5DE5\u4F5C\u7684\u7EBF\u7A0B\u6570\uFF08\u5E76\u53D1\u6570\uFF09&gt;1 ,\u90A3\u4E48/order/test5 \u5C31\u4F1A\u88AB\u6D41\u63A7</p></blockquote><p><img src="'+P+'" alt="image-20210818165552976"></p><h2 id="_2-5-qps\u8D85\u8FC7\u9608\u503C\u94FE\u8DEF\u5931\u8D25" tabindex="-1"><a class="header-anchor" href="#_2-5-qps\u8D85\u8FC7\u9608\u503C\u94FE\u8DEF\u5931\u8D25" aria-hidden="true">#</a> 2.5\uFF1AQPS\u8D85\u8FC7\u9608\u503C\u94FE\u8DEF\u5931\u8D25</h2><p><img src="'+D+`" alt="image-20210818170718455"></p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">feign.sentinel.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">spring.cloud.sentinel.web-context-unify</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>\u89E6\u53D1\u6761\u4EF6\uFF1AsaveOrder[jifen save]\u6709\u4E24\u4E2A\u5165\u53E3\uFF0C\u5206\u522B\u4E3A/order/test5\u548C/order/test6</p><p>\u5F53/order/test5\u8BBF\u95EEqps&gt;1 \u90A3\u4E48/order/test5\u5C31\u4E0D\u80FD\u8BBF\u95EE\u53D7\u4FDD\u62A4\u8D44\u6E90,\u5176\u4ED6\u5165\u53E3\u7167\u5E38\u8BBF\u95EE</p></blockquote><p><img src="`+I+'" alt="image-20210818172601364"></p><h2 id="_2-6-\u6D41\u63A7\u6548\u679C-warm-up" tabindex="-1"><a class="header-anchor" href="#_2-6-\u6D41\u63A7\u6548\u679C-warm-up" aria-hidden="true">#</a> 2.6\uFF1A\u6D41\u63A7\u6548\u679C-Warm-up</h2><blockquote><p>Warm Up\uFF08<code>RuleConstant.CONTROL_BEHAVIOR_WARM_UP</code>\uFF09\u65B9\u5F0F\uFF0C\u5373\u9884\u70ED/\u51B7\u542F\u52A8\u65B9\u5F0F\u3002\u5F53\u7CFB\u7EDF\u957F\u671F\u5904\u4E8E\u4F4E\u6C34\u4F4D\u7684\u60C5\u51B5\u4E0B\uFF0C\u5F53\u6D41\u91CF\u7A81\u7136\u589E\u52A0\u65F6\uFF0C\u76F4\u63A5\u628A\u7CFB\u7EDF\u62C9\u5347\u5230\u9AD8\u6C34\u4F4D\u53EF\u80FD\u77AC\u95F4\u628A\u7CFB\u7EDF\u538B\u57AE\u3002\u901A\u8FC7&quot;\u51B7\u542F\u52A8&quot;\uFF0C\u8BA9\u901A\u8FC7\u7684\u6D41\u91CF\u7F13\u6162\u589E\u52A0\uFF0C\u5728\u4E00\u5B9A\u65F6\u95F4\u5185\u9010\u6E10\u589E\u52A0\u5230\u9608\u503C\u4E0A\u9650\uFF0C\u7ED9\u51B7\u7CFB\u7EDF\u4E00\u4E2A\u9884\u70ED\u7684\u65F6\u95F4\uFF0C\u907F\u514D\u51B7\u7CFB\u7EDF\u88AB\u538B\u57AE</p></blockquote><blockquote><p>\u9ED8\u8BA4 <code>coldFactor</code> \u4E3A 3\uFF0C\u5373\u8BF7\u6C42 QPS \u4ECE <code>threshold / 3</code> \u5F00\u59CB\uFF0C\u7ECF\u9884\u70ED\u65F6\u957F\u9010\u6E10\u5347\u81F3\u8BBE\u5B9A\u7684 QPS \u9608\u503C\u3002</p></blockquote><p><img src="'+F+'" alt="image-20201028050506550"></p><p>\u573A\u666F\uFF1A</p><p><img src="'+j+'" alt="image-20210201214231216"></p><h2 id="_2-7-\u6D41\u63A7\u6548\u679C-\u5300\u901F\u6392\u961F" tabindex="-1"><a class="header-anchor" href="#_2-7-\u6D41\u63A7\u6548\u679C-\u5300\u901F\u6392\u961F" aria-hidden="true">#</a> 2.7\uFF1A\u6D41\u63A7\u6548\u679C-\u5300\u901F\u6392\u961F</h2>',79),V=s("code",null,"RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER",-1),G={href:"https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6-%E5%8C%80%E9%80%9F%E6%8E%92%E9%98%9F%E6%A8%A1%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"},z={href:"https://github.com/alibaba/Sentinel/blob/master/sentinel-demo/sentinel-demo-basic/src/main/java/com/alibaba/csp/sentinel/demo/flow/PaceFlowDemo.java",target:"_blank",rel:"noopener noreferrer"},K=a('<p><img src="'+E+'" alt="image-20210329230935856"></p><p>\u8FD9\u79CD\u65B9\u5F0F\u4E3B\u8981\u7528\u4E8E\u5904\u7406\u95F4\u9694\u6027\u7A81\u53D1\u7684\u6D41\u91CF\uFF0C\u4F8B\u5982\u6D88\u606F\u961F\u5217\u3002\u60F3\u8C61\u4E00\u4E0B\u8FD9\u6837\u7684\u573A\u666F\uFF0C\u5728\u67D0\u4E00\u79D2\u6709\u5927\u91CF\u7684\u8BF7\u6C42\u5230\u6765\uFF0C\u800C\u63A5\u4E0B\u6765\u7684\u51E0\u79D2\u5219\u5904\u4E8E\u7A7A\u95F2\u72B6\u6001\uFF0C\u6211\u4EEC\u5E0C\u671B\u7CFB\u7EDF\u80FD\u591F\u5728\u63A5\u4E0B\u6765\u7684\u7A7A\u95F2\u671F\u95F4\u9010\u6E10\u5904\u7406\u8FD9\u4E9B\u8BF7\u6C42\uFF0C\u800C\u4E0D\u662F\u5728\u7B2C\u4E00\u79D2\u76F4\u63A5\u62D2\u7EDD\u591A\u4F59\u7684\u8BF7\u6C42\u3002</p><blockquote><p>\u6CE8\u610F\uFF1A\u5300\u901F\u6392\u961F\u6A21\u5F0F\u6682\u65F6\u4E0D\u652F\u6301 QPS &gt; 1000 \u7684\u573A\u666F\u3002</p></blockquote><h1 id="\u4E09-sentinel\u670D\u52A1\u7194\u65AD\u964D\u7EA7" tabindex="-1"><a class="header-anchor" href="#\u4E09-sentinel\u670D\u52A1\u7194\u65AD\u964D\u7EA7" aria-hidden="true">#</a> \u4E09\uFF1ASentinel\u670D\u52A1\u7194\u65AD\u964D\u7EA7</h1><blockquote><p>\u9664\u4E86\u6D41\u91CF\u63A7\u5236\u4EE5\u5916\uFF0C\u5BF9\u8C03\u7528\u94FE\u8DEF\u4E2D\u4E0D\u7A33\u5B9A\u7684\u8D44\u6E90\u8FDB\u884C\u7194\u65AD\u964D\u7EA7\u4E5F\u662F\u4FDD\u969C\u9AD8\u53EF\u7528\u7684\u91CD\u8981\u63AA\u65BD\u4E4B\u4E00\u3002\u4E00\u4E2A\u670D\u52A1\u5E38\u5E38\u4F1A\u8C03\u7528\u522B\u7684\u6A21\u5757\uFF0C\u53EF\u80FD\u662F\u53E6\u5916\u7684\u4E00\u4E2A\u8FDC\u7A0B\u670D\u52A1\u3001\u6570\u636E\u5E93\uFF0C\u6216\u8005\u7B2C\u4E09\u65B9 API \u7B49\u3002\u4F8B\u5982\uFF0C\u652F\u4ED8\u7684\u65F6\u5019\uFF0C\u53EF\u80FD\u9700\u8981\u8FDC\u7A0B\u8C03\u7528\u94F6\u8054\u63D0\u4F9B\u7684 API\uFF1B\u67E5\u8BE2\u67D0\u4E2A\u5546\u54C1\u7684\u4EF7\u683C\uFF0C\u53EF\u80FD\u9700\u8981\u8FDB\u884C\u6570\u636E\u5E93\u67E5\u8BE2\u3002\u7136\u800C\uFF0C\u8FD9\u4E2A\u88AB\u4F9D\u8D56\u670D\u52A1\u7684\u7A33\u5B9A\u6027\u662F\u4E0D\u80FD\u4FDD\u8BC1\u7684\u3002\u5982\u679C\u4F9D\u8D56\u7684\u670D\u52A1\u51FA\u73B0\u4E86\u4E0D\u7A33\u5B9A\u7684\u60C5\u51B5\uFF0C\u8BF7\u6C42\u7684\u54CD\u5E94\u65F6\u95F4\u53D8\u957F\uFF0C\u90A3\u4E48\u8C03\u7528\u670D\u52A1\u7684\u65B9\u6CD5\u7684\u54CD\u5E94\u65F6\u95F4\u4E5F\u4F1A\u53D8\u957F\uFF0C\u7EBF\u7A0B\u4F1A\u4EA7\u751F\u5806\u79EF\uFF0C\u6700\u7EC8\u53EF\u80FD\u8017\u5C3D\u4E1A\u52A1\u81EA\u8EAB\u7684\u7EBF\u7A0B\u6C60\uFF0C\u670D\u52A1\u672C\u8EAB\u4E5F\u53D8\u5F97\u4E0D\u53EF\u7528\u3002</p></blockquote><h2 id="_3-1-\u7194\u65AD\u964D\u7EA7-\u6162\u8C03\u7528\u6BD4\u4F8B" tabindex="-1"><a class="header-anchor" href="#_3-1-\u7194\u65AD\u964D\u7EA7-\u6162\u8C03\u7528\u6BD4\u4F8B" aria-hidden="true">#</a> 3.1\uFF1A\u7194\u65AD\u964D\u7EA7- \u6162\u8C03\u7528\u6BD4\u4F8B</h2><blockquote><p>\u6162\u8C03\u7528\u6BD4\u4F8B (<code>SLOW_REQUEST_RATIO</code>)\uFF1A\u9009\u62E9\u4EE5\u6162\u8C03\u7528\u6BD4\u4F8B\u4F5C\u4E3A\u9608\u503C\uFF0C\u9700\u8981\u8BBE\u7F6E\u5141\u8BB8\u7684\u6162\u8C03\u7528 RT\uFF08\u5373\u6700\u5927\u7684\u54CD\u5E94\u65F6\u95F4\uFF09\uFF0C\u8BF7\u6C42\u7684\u54CD\u5E94\u65F6\u95F4\u5927\u4E8E\u8BE5\u503C\u5219\u7EDF\u8BA1\u4E3A\u6162\u8C03\u7528\u3002\u5F53\u5355\u4F4D\u7EDF\u8BA1\u65F6\u957F\uFF08<code>statIntervalMs</code>\uFF09\u5185\u8BF7\u6C42\u6570\u76EE\u5927\u4E8E\u8BBE\u7F6E\u7684\u6700\u5C0F\u8BF7\u6C42\u6570\u76EE\uFF0C\u5E76\u4E14\u6162\u8C03\u7528\u7684\u6BD4\u4F8B\u5927\u4E8E\u9608\u503C\uFF0C\u5219\u63A5\u4E0B\u6765\u7684\u7194\u65AD\u65F6\u957F\u5185\u8BF7\u6C42\u4F1A\u81EA\u52A8\u88AB\u7194\u65AD\u3002\u7ECF\u8FC7\u7194\u65AD\u65F6\u957F\u540E\u7194\u65AD\u5668\u4F1A\u8FDB\u5165\u63A2\u6D4B\u6062\u590D\u72B6\u6001\uFF08HALF-OPEN \u72B6\u6001\uFF09\uFF0C\u82E5\u63A5\u4E0B\u6765\u7684\u4E00\u4E2A\u8BF7\u6C42\u54CD\u5E94\u65F6\u95F4\u5C0F\u4E8E\u8BBE\u7F6E\u7684\u6162\u8C03\u7528 RT \u5219\u7ED3\u675F\u7194\u65AD\uFF0C\u82E5\u5927\u4E8E\u8BBE\u7F6E\u7684\u6162\u8C03\u7528 RT \u5219\u4F1A\u518D\u6B21\u88AB\u7194\u65AD\u3002</p></blockquote><blockquote><p>\u65AD\u8DEF\u5668\u7684\u5DE5\u4F5C\u6D41\u7A0B\uFF1A</p><p>\u4E00\u65E6\u7194\u65AD\uFF0C\u65AD\u8DEF\u5668\u7684\u72B6\u6001\u662FOpen\uFF08\u6240\u6709\u7684\u8BF7\u6C42\u90FD\u4E0D\u80FD\u8FDB\u6765\uFF09</p><p>\u5F53\u7194\u65AD\u65F6\u957F\u7ED3\u675F\uFF0C\u65AD\u8DEF\u5668\u7684\u72B6\u6001\u662Fhalf-Open\uFF08\u53EF\u4EE5\u5141\u8BB8\u4E00\u4E2A\u8BF7\u6C42\u8FDB\u6765\uFF09</p><p>\u5982\u679C\u63A5\u4E0B\u6765\u7684\u8BF7\u6C42\u6B63\u5E38\uFF0C\u65AD\u8DEF\u5668\u7684\u72B6\u6001\u662Fclose\uFF08\u8D44\u6E90\u5C31\u81EA\u6062\u590D\uFF09</p><p>\u5982\u679C\u63A5\u4E0B\u6765\u7684\u8BF7\u6C42\u4E0D\u6B63\u5E38\uFF0C\u65AD\u8DEF\u5668\u7684\u72B6\u6001\u662Fopen</p></blockquote><blockquote><p>\u89E6\u53D1\u6761\u4EF6</p><p>1\uFF1A1s\u5185\u6700\u5C0F\u8BF7\u6C42\u6570\u5FC5\u987B\u5927\u4E8E5</p><p>2\uFF1A\u6162\u8BF7\u6C42/\u603B\u8BF7\u6C42 &gt; 0.6</p></blockquote><p><img src="'+O+`" alt="image-20210819105935516"></p><p>\u6F14\u793A\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;test5&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token class-name">String</span> flag<span class="token punctuation">)</span><span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token string">&quot;test5&quot;</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-2-\u7194\u65AD\u964D\u7EA7-\u5F02\u5E38\u6BD4\u4F8B" tabindex="-1"><a class="header-anchor" href="#_3-2-\u7194\u65AD\u964D\u7EA7-\u5F02\u5E38\u6BD4\u4F8B" aria-hidden="true">#</a> 3.2\uFF1A\u7194\u65AD\u964D\u7EA7-\u5F02\u5E38\u6BD4\u4F8B</h2><blockquote><p>\u5F02\u5E38\u6BD4\u4F8B (<code>ERROR_RATIO</code>)\uFF1A\u5F53\u5355\u4F4D\u7EDF\u8BA1\u65F6\u957F\uFF08<code>statIntervalMs</code>\uFF09\u5185\u8BF7\u6C42\u6570\u76EE\u5927\u4E8E\u8BBE\u7F6E\u7684\u6700\u5C0F\u8BF7\u6C42\u6570\u76EE\uFF0C\u5E76\u4E14\u5F02\u5E38\u7684\u6BD4\u4F8B\u5927\u4E8E\u9608\u503C\uFF0C\u5219\u63A5\u4E0B\u6765\u7684\u7194\u65AD\u65F6\u957F\u5185\u8BF7\u6C42\u4F1A\u81EA\u52A8\u88AB\u7194\u65AD\u3002\u7ECF\u8FC7\u7194\u65AD\u65F6\u957F\u540E\u7194\u65AD\u5668\u4F1A\u8FDB\u5165\u63A2\u6D4B\u6062\u590D\u72B6\u6001\uFF08HALF-OPEN \u72B6\u6001\uFF09\uFF0C\u82E5\u63A5\u4E0B\u6765\u7684\u4E00\u4E2A\u8BF7\u6C42\u6210\u529F\u5B8C\u6210\uFF08\u6CA1\u6709\u9519\u8BEF\uFF09\u5219\u7ED3\u675F\u7194\u65AD\uFF0C\u5426\u5219\u4F1A\u518D\u6B21\u88AB\u7194\u65AD\u3002\u5F02\u5E38\u6BD4\u7387\u7684\u9608\u503C\u8303\u56F4\u662F <code>[0.0, 1.0]</code>\uFF0C\u4EE3\u8868 0% - 100%\u3002</p></blockquote><blockquote><p>\u65AD\u8DEF\u5668\u7684\u5DE5\u4F5C\u6D41\u7A0B\uFF1A</p><p>\u4E00\u65E6\u7194\u65AD\uFF0C\u65AD\u8DEF\u5668\u7684\u72B6\u6001\u662FOpen\uFF08\u6240\u6709\u7684\u8BF7\u6C42\u90FD\u4E0D\u80FD\u8FDB\u6765\uFF09</p><p>\u5F53\u7194\u65AD\u65F6\u957F\u7ED3\u675F\uFF0C\u65AD\u8DEF\u5668\u7684\u72B6\u6001\u662Fhalf-Open\uFF08\u53EF\u4EE5\u5141\u8BB8\u4E00\u4E2A\u8BF7\u6C42\u8FDB\u6765\uFF09</p><p>\u5982\u679C\u63A5\u4E0B\u6765\u7684\u8BF7\u6C42\u6B63\u5E38\uFF0C\u65AD\u8DEF\u5668\u7684\u72B6\u6001\u662Fclose\uFF08\u8D44\u6E90\u5C31\u81EA\u6062\u590D\uFF09</p><p>\u5982\u679C\u63A5\u4E0B\u6765\u7684\u8BF7\u6C42\u4E0D\u6B63\u5E38\uFF0C\u65AD\u8DEF\u5668\u7684\u72B6\u6001\u662Fopen</p></blockquote><blockquote><p>\u89E6\u53D1\u6761\u4EF6</p><p>1\uFF1A1s\u5185\u6700\u5C0F\u8BF7\u6C42\u6570\u5927\u4E8E5</p><p>2\uFF1A1s\u5185 \u5F02\u5E38\u6570/\u603B\u8BF7\u6C42\u6570 &gt; 0.6</p></blockquote><p><img src="`+L+`" alt="image-20210819113541440"></p><p>\u6F14\u793A\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;test6&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token class-name">String</span> flag<span class="token punctuation">)</span><span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;\u53C2\u6570\u5F02\u5E38&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token string">&quot;test6&quot;</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-3-\u7194\u65AD\u964D\u7EA7-\u5F02\u5E38\u6570" tabindex="-1"><a class="header-anchor" href="#_3-3-\u7194\u65AD\u964D\u7EA7-\u5F02\u5E38\u6570" aria-hidden="true">#</a> 3.3\uFF1A\u7194\u65AD\u964D\u7EA7-\u5F02\u5E38\u6570</h2><blockquote><p>\u5F02\u5E38\u6570 (<code>ERROR_COUNT</code>)\uFF1A\u5F53\u5355\u4F4D\u7EDF\u8BA1\u65F6\u957F\u5185\u7684\u5F02\u5E38\u6570\u76EE\u8D85\u8FC7\u9608\u503C\u4E4B\u540E\u4F1A\u81EA\u52A8\u8FDB\u884C\u7194\u65AD\u3002\u7ECF\u8FC7\u7194\u65AD\u65F6\u957F\u540E\u7194\u65AD\u5668\u4F1A\u8FDB\u5165\u63A2\u6D4B\u6062\u590D\u72B6\u6001\uFF08HALF-OPEN \u72B6\u6001\uFF09\uFF0C\u82E5\u63A5\u4E0B\u6765\u7684\u4E00\u4E2A\u8BF7\u6C42\u6210\u529F\u5B8C\u6210\uFF08\u6CA1\u6709\u9519\u8BEF\uFF09\u5219\u7ED3\u675F\u7194\u65AD\uFF0C\u5426\u5219\u4F1A\u518D\u6B21\u88AB\u7194\u65AD\u3002</p><p>\u89E6\u53D1\u6761\u4EF6</p><p>1\uFF1A\u6BCF\u79D2\u8BF7\u6C42\u6570\u5FC5\u987B\u5927\u4E8E5</p><p>2\uFF1A\u6BCF\u79D2\u7684\u5F02\u5E38\u6570\u5FC5\u987B\u5927\u4E8E10\u3010\u6211\u4EEC\u8BBE\u7F6E\u7684\u9608\u503C\u3011</p></blockquote><p><img src="`+H+'" alt="image-20210511163229443"></p><h1 id="\u56DB-sentinel-\u70ED\u70B9key\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#\u56DB-sentinel-\u70ED\u70B9key\u89C4\u5219" aria-hidden="true">#</a> \u56DB\uFF1ASentinel-\u70ED\u70B9key\u89C4\u5219</h1><blockquote><p>\u89E6\u53D1\u6761\u4EF6</p><p>1\uFF1A\u5FC5\u987B\u6709\u4E00\u4E2A\u53C2\u6570\uFF0C\u53C2\u6570\u7684\u503C\u53EF\u4EE5\u4EFB\u610F \u4F8B\u5982\uFF1Ahttp://localhost:9002/order/test7?name=jack</p><p>2\uFF1A\u63A5\u53E3\u8BBF\u95EEqps&gt;1</p></blockquote><p><img src="'+N+'" alt="image-20210819140928599"></p><blockquote><p>\u89E6\u53D1\u6761\u4EF6</p><p>1\uFF1A\u7B2C\u4E00\u4E2A\u53C2\u6570\u7684\u503C\u5982\u679C\u4E3Ajack\uFF0C\u90A3\u4E48qps\u9608\u503C\u4E3A1</p><p>2\uFF1A\u7B2C\u4E00\u4E2A\u53C2\u6570\u7684\u503C\u5982\u679C\u4E3Arose\uFF0C\u90A3\u4E48qps\u9608\u503C\u4E3A5</p><p>3\uFF1A\u7B2C\u4E00\u4E2A\u53C2\u6570\u7684\u503C\u5982\u679C\u4E3A\u5176\u4ED6\uFF0C\u90A3\u4E48qps\u9608\u503C\u4E3A1</p></blockquote><p><img src="'+C+'" alt="image-20210819141742327"></p><p>\u6CE8\u610F\u4E8B\u9879\uFF1A</p><p><img src="'+M+'" alt="image-20210330163338800"></p><h1 id="\u4E94-sentinel-\u6743\u9650\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#\u4E94-sentinel-\u6743\u9650\u89C4\u5219" aria-hidden="true">#</a> \u4E94\uFF1ASentinel-\u6743\u9650\u89C4\u5219</h1><blockquote><p>/goods/findById/{id} \u5BF9\u4E8Ecloud-order\u4E0D\u80FD\u8C03\u7528</p></blockquote><p><img src="'+T+`" alt="image-20210819143451408"></p><p>\u4ECE\u8BF7\u6C42\u5934\u83B7\u53D6source</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wfx<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>webmvc<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span><span class="token class-name">RequestOriginParser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerRequestOriginParser</span> <span class="token keyword">implements</span> <span class="token class-name">RequestOriginParser</span> <span class="token punctuation">{</span>


    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">parseOrigin</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;come in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u83B7\u53D6\u8BF7\u6C42\u5934\u7684source</span>
        <span class="token class-name">String</span> source1 <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>source1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> source1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>openFeign\u6307\u5B9A\u8BF7\u6C42\u5934\uFF0C\u53D1\u9001\u8BF7\u6C42</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u63A5\u53E3\u58F0\u660E(\u6839\u636Eid\u83B7\u53D6\u79EF\u5206)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/jifen/{jifenId}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Jifen</span> <span class="token function">findJifenById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;jifenId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> jifenId<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>openfeign\u62E6\u622A\u5668\u7EDF\u4E00\u8BBE\u7F6E\u8BF7\u6C42\u5934</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wfx<span class="token punctuation">.</span>feign</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">feign<span class="token punctuation">.</span></span><span class="token class-name">RequestInterceptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">feign<span class="token punctuation">.</span></span><span class="token class-name">RequestTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>title: com.wfx.feign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * author zhuximing
 * description:
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerRequestInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">RequestInterceptor</span> <span class="token punctuation">{</span>


    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">RequestTemplate</span> requestTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//\u7EDF\u4E00\u8BBE\u7F6E\u8BF7\u6C42\u5934</span>
        requestTemplate<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;wfx-order1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="\u516D-sentinel-\u9488\u5BF9\u6765\u6E90" tabindex="-1"><a class="header-anchor" href="#\u516D-sentinel-\u9488\u5BF9\u6765\u6E90" aria-hidden="true">#</a> \u516D\uFF1ASentinel-\u9488\u5BF9\u6765\u6E90</h1><p><img src="`+A+`" alt="image-20201029094519063"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wfx<span class="token punctuation">.</span>sentinel</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>webmvc<span class="token punctuation">.</span>callback<span class="token punctuation">.</span></span><span class="token class-name">RequestOriginParser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>title: com.wfx.sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * author zhuximing
 * description:
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerRequestOriginParser</span>  <span class="token keyword">implements</span> <span class="token class-name">RequestOriginParser</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">parseOrigin</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> httpServletRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">String</span> source <span class="token operator">=</span> httpServletRequest<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;come in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;source&quot;</span><span class="token operator">+</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">return</span>  source<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="\u4E03-\u7CFB\u7EDF\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#\u4E03-\u7CFB\u7EDF\u89C4\u5219" aria-hidden="true">#</a> \u4E03\uFF1A\u7CFB\u7EDF\u89C4\u5219</h1><blockquote><ul><li><strong>Load \u81EA\u9002\u5E94</strong>\uFF08\u4EC5\u5BF9 Linux/Unix-like \u673A\u5668\u751F\u6548\uFF09\uFF1A\u7CFB\u7EDF\u7684 load1 \u4F5C\u4E3A\u542F\u53D1\u6307\u6807\uFF0C\u8FDB\u884C\u81EA\u9002\u5E94\u7CFB\u7EDF\u4FDD\u62A4\u3002\u5F53\u7CFB\u7EDF load1 \u8D85\u8FC7\u8BBE\u5B9A\u7684\u542F\u53D1\u503C\uFF0C\u4E14\u7CFB\u7EDF\u5F53\u524D\u7684\u5E76\u53D1\u7EBF\u7A0B\u6570\u8D85\u8FC7\u4F30\u7B97\u7684\u7CFB\u7EDF\u5BB9\u91CF\u65F6\u624D\u4F1A\u89E6\u53D1\u7CFB\u7EDF\u4FDD\u62A4\uFF08BBR \u9636\u6BB5\uFF09\u3002\u7CFB\u7EDF\u5BB9\u91CF\u7531\u7CFB\u7EDF\u7684 <code>maxQps * minRt</code> \u4F30\u7B97\u5F97\u51FA\u3002\u8BBE\u5B9A\u53C2\u8003\u503C\u4E00\u822C\u662F <code>CPU cores * 2.5</code>\u3002</li><li><strong>CPU usage</strong>\uFF081.5.0+ \u7248\u672C\uFF09\uFF1A\u5F53\u7CFB\u7EDF CPU \u4F7F\u7528\u7387\u8D85\u8FC7\u9608\u503C\u5373\u89E6\u53D1\u7CFB\u7EDF\u4FDD\u62A4\uFF08\u53D6\u503C\u8303\u56F4 0.0-1.0\uFF09\uFF0C\u6BD4\u8F83\u7075\u654F\u3002</li><li><strong>\u5E73\u5747 RT</strong>\uFF1A\u5F53\u5355\u53F0\u673A\u5668\u4E0A\u6240\u6709\u5165\u53E3\u6D41\u91CF\u7684\u5E73\u5747 RT \u8FBE\u5230\u9608\u503C\u5373\u89E6\u53D1\u7CFB\u7EDF\u4FDD\u62A4\uFF0C\u5355\u4F4D\u662F\u6BEB\u79D2\u3002</li><li><strong>\u5E76\u53D1\u7EBF\u7A0B\u6570</strong>\uFF1A\u5F53\u5355\u53F0\u673A\u5668\u4E0A\u6240\u6709\u5165\u53E3\u6D41\u91CF\u7684\u5E76\u53D1\u7EBF\u7A0B\u6570\u8FBE\u5230\u9608\u503C\u5373\u89E6\u53D1\u7CFB\u7EDF\u4FDD\u62A4\u3002</li><li><strong>\u5165\u53E3 QPS</strong>\uFF1A\u5F53\u5355\u53F0\u673A\u5668\u4E0A\u6240\u6709\u5165\u53E3\u6D41\u91CF\u7684 QPS \u8FBE\u5230\u9608\u503C\u5373\u89E6\u53D1\u7CFB\u7EDF\u4FDD\u62A4\u3002</li></ul></blockquote><h1 id="\u516B-sentinelresource\u6CE8\u89E3" tabindex="-1"><a class="header-anchor" href="#\u516B-sentinelresource\u6CE8\u89E3" aria-hidden="true">#</a> \u516B\uFF1A@SentinelResource\u6CE8\u89E3</h1><h2 id="_8-1-\u6D41\u63A7\u81EA\u5B9A\u4E49\u5F02\u5E38\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#_8-1-\u6D41\u63A7\u81EA\u5B9A\u4E49\u5F02\u5E38\u5904\u7406" aria-hidden="true">#</a> 8.1\uFF1A\u6D41\u63A7\u81EA\u5B9A\u4E49\u5F02\u5E38\u5904\u7406</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  <span class="token comment">//\u4E3B\u903B\u8F91</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;test9&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;test9&quot;</span><span class="token punctuation">,</span>blockHandler<span class="token operator">=</span><span class="token string">&quot;test9Handler&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test9</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>


        <span class="token comment">//todo ...</span>

        <span class="token keyword">return</span> <span class="token string">&quot;test9&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



    <span class="token comment">//\u5907\u9009\u903B\u8F91</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test9Handler</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>


        <span class="token keyword">return</span> <span class="token string">&quot;\u7CFB\u7EDF\u7E41\u5FD9\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5!!!&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-2-\u6D41\u63A7\u81EA\u5B9A\u4E49\u5F02\u5E38\u4F18\u5316" tabindex="-1"><a class="header-anchor" href="#_8-2-\u6D41\u63A7\u81EA\u5B9A\u4E49\u5F02\u5E38\u4F18\u5316" aria-hidden="true">#</a> 8.2\uFF1A\u6D41\u63A7\u81EA\u5B9A\u4E49\u5F02\u5E38\u4F18\u5316</h2><p>\u81EA\u5B9A\u4E49</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u6838\u5FC3\u4E3B\u903B\u8F91</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;test-d&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;test-d&quot;</span><span class="token punctuation">,</span>blockHandlerClass<span class="token operator">=</span> <span class="token class-name">CustomBlockHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>blockHandler<span class="token operator">=</span><span class="token string">&quot;testblockHandler&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span>  <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;200&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wfx<span class="token punctuation">.</span>blockHandler</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomBlockHandler</span> <span class="token punctuation">{</span>


    <span class="token comment">//\u964D\u7EA7\u903B\u8F91(\u5907\u9009\u903B\u8F91),BlockException\u53C2\u6570\u5FC5\u987B\u5199</span>
    <span class="token comment">//\u65B9\u6CD5\u5B9A\u4E49\u4E3A\u9759\u6001\u65B9\u6CD5</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Map</span> <span class="token function">testblockHandler</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">BlockException</span> exception<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;200&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;\u7CFB\u7EDF\u7E41\u5FD9\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5!!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-3-\u7194\u65AD\u964D\u7EA7\u81EA\u5B9A\u4E49\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#_8-3-\u7194\u65AD\u964D\u7EA7\u81EA\u5B9A\u4E49\u5904\u7406" aria-hidden="true">#</a> 8.3\uFF1A\u7194\u65AD\u964D\u7EA7\u81EA\u5B9A\u4E49\u5904\u7406</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  <span class="token comment">//\u4E3B\u903B\u8F91</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;test6&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;test6&quot;</span><span class="token punctuation">,</span>fallback <span class="token operator">=</span> <span class="token string">&quot;test6Handler&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token class-name">String</span> flag<span class="token punctuation">)</span><span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;\u53C2\u6570\u5F02\u5E38&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token string">&quot;test6&quot;</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//\u5907\u9009</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test6Handler</span><span class="token punctuation">(</span><span class="token class-name">String</span> flag<span class="token punctuation">,</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span><span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>


        <span class="token keyword">if</span><span class="token punctuation">(</span>throwable <span class="token keyword">instanceof</span> <span class="token class-name">DegradeException</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;\u7CFB\u7EDF\u5F00\u5C0F\u5DEE\uFF0C\u4E00\u4F1A\u91CD\u8BD5!!!&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;\u975Esentinel\u5F02\u5E38&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-4-\u7194\u65AD\u964D\u7EA7\u81EA\u5B9A\u4E49\u5904\u7406\u4F18\u5316" tabindex="-1"><a class="header-anchor" href="#_8-4-\u7194\u65AD\u964D\u7EA7\u81EA\u5B9A\u4E49\u5904\u7406\u4F18\u5316" aria-hidden="true">#</a> 8.4\uFF1A\u7194\u65AD\u964D\u7EA7\u81EA\u5B9A\u4E49\u5904\u7406\u4F18\u5316</h2><p>\u4E3B\u903B\u8F91</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>  <span class="token comment">//\u4E3B\u903B\u8F91</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SentinelResource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>fallback<span class="token operator">=</span><span class="token string">&quot;testFallback&quot;</span><span class="token punctuation">,</span>fallbackClass<span class="token operator">=</span> <span class="token class-name">HandleFallback</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> flag<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;\u53C2\u6570\u5F02\u5E38&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">return</span> <span class="token string">&quot;test&quot;</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u964D\u7EA7\u903B\u8F91</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>wfx<span class="token punctuation">.</span>sentinel</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>degrade<span class="token punctuation">.</span></span><span class="token class-name">DegradeException</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>title: com.wfx.sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * author zhuximing
 * description:
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandleFallback</span> <span class="token punctuation">{</span>

    <span class="token comment">//\u964D\u7EA7\u903B\u8F91</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">testFallback</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> flag<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>throwable <span class="token keyword">instanceof</span> <span class="token class-name">DegradeException</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;\u89E6\u53D1\u4E86\u7194\u65AD\u7CFB\u7EDF\u5F00\u4E86\u4E2A\u73A9\u7B11\uFF01\uFF01\uFF01&quot;</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;\u5176\u4ED6\u5F02\u5E38\u7CFB\u7EDF\u5F00\u4E86\u4E2A\u73A9\u7B11\uFF01\uFF01\uFF01&quot;</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-5-\u5168\u5C40\u5F02\u5E38\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#_8-5-\u5168\u5C40\u5F02\u5E38\u5904\u7406" aria-hidden="true">#</a> 8.5\uFF1A\u5168\u5C40\u5F02\u5E38\u5904\u7406</h2><blockquote><p>springboot\u5168\u5C40\u5F02\u5E38\u5904\u7406</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>qf<span class="token punctuation">.</span>exception</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>authority<span class="token punctuation">.</span></span><span class="token class-name">AuthorityException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>degrade<span class="token punctuation">.</span></span><span class="token class-name">DegradeException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>flow<span class="token punctuation">.</span></span><span class="token class-name">FlowException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ControllerAdvice</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExceptionHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>title: com.qf.exception<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Company: wendao<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * author zhuximing
 * date 2021/8/19
 * description:
 */</span>
<span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerExceptionHandler</span> <span class="token punctuation">{</span>


    <span class="token comment">//\u6D41\u63A7\u89C4\u5219\uFF0C\u5168\u5C40\u5F02\u5E38\u5904\u7406</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">FlowException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">handlerFlowExcetoption</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span>  <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\u7CFB\u7D71\u7E41\u5FD9\uFF0C\u7A0D\u540E\u91CD\u8BD5\uFF01\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


    <span class="token comment">//\u7194\u65AD\u964D\u7EA7\u89C4\u5219\uFF0C\u5168\u5C40\u5F02\u5E38\u5904\u7406</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">DegradeException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">handlerDegradeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span>  <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\u7CFB\u7EDF\u5F00\u5C0F\u5DEE\uFF0C\u7A0D\u540E\u91CD\u8BD5\uFF01\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


    <span class="token comment">//\u6743\u9650\u89C4\u5219\uFF0C\u5168\u5C40\u5F02\u5E38\u5904\u7406</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">AuthorityException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span> <span class="token function">handlerAuthorityException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span>  <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;5xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\uFF0C\u6CA1\u6709\u6743\u9650\u8BBF\u95EE\uFF01\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="\u4E5D-sentinel\u89C4\u5219\u6301\u4E45\u5316" tabindex="-1"><a class="header-anchor" href="#\u4E5D-sentinel\u89C4\u5219\u6301\u4E45\u5316" aria-hidden="true">#</a> \u4E5D\uFF1ASentinel\u89C4\u5219\u6301\u4E45\u5316</h1><h2 id="_9-1-\u539F\u59CB\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_9-1-\u539F\u59CB\u6A21\u5F0F" aria-hidden="true">#</a> 9.1\uFF1A\u539F\u59CB\u6A21\u5F0F</h2><p>\u5982\u679C\u4E0D\u505A\u4EFB\u4F55\u4FEE\u6539\uFF0CDashboard \u7684\u63A8\u9001\u89C4\u5219\u65B9\u5F0F\u662F\u901A\u8FC7 API \u5C06\u89C4\u5219\u63A8\u9001\u81F3\u5BA2\u6237\u7AEF\u5E76\u76F4\u63A5\u66F4\u65B0\u5230\u5185\u5B58\u4E2D\uFF1A</p><p>\u8FD9\u79CD\u505A\u6CD5\u7684\u597D\u5904\u662F\u7B80\u5355\uFF0C\u65E0\u4F9D\u8D56\uFF1B\u574F\u5904\u662F\u5E94\u7528\u91CD\u542F\u89C4\u5219\u5C31\u4F1A\u6D88\u5931\uFF0C\u4EC5\u7528\u4E8E\u7B80\u5355\u6D4B\u8BD5\uFF0C\u4E0D\u80FD\u7528\u4E8E\u751F\u4EA7\u73AF\u5883\u3002</p><p><img src="`+W+'" alt="image-20210331105236701"></p><h2 id="_9-2-pull\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_9-2-pull\u6A21\u5F0F" aria-hidden="true">#</a> 9.2\uFF1APull\u6A21\u5F0F</h2><p>FileRefreshableDataSource <strong>\u5B9A\u65F6</strong>\u4ECE\u6307\u5B9A\u6587\u4EF6\u4E2D\u8BFB\u53D6\u89C4\u5219JSON\u6587\u4EF6\u3010\u56FE\u4E2D\u7684\u672C\u5730\u6587\u4EF6\u3011\uFF0C\u5982\u679C\u53D1\u73B0\u6587\u4EF6\u53D1\u751F\u53D8\u5316\uFF0C\u5C31\u66F4\u65B0\u89C4\u5219\u7F13\u5B58\u3002</p><p>FileWritableDataSource \u63A5\u6536\u63A7\u5236\u53F0\u89C4\u5219\u63A8\u9001\uFF0C\u5E76\u6839\u636E\u914D\u7F6E\uFF0C\u4FEE\u6539\u89C4\u5219JSON\u6587\u4EF6\u3010\u56FE\u4E2D\u7684\u672C\u5730\u6587\u4EF6\u3011\u3002</p><p><img src="'+$+`" alt="q"></p><h3 id="_9-2-1-pom\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_9-2-1-pom\u4F9D\u8D56" aria-hidden="true">#</a> 9.2.1\uFF1Apom\u4F9D\u8D56</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-extension<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-2-\u6838\u5FC3\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#_9-2-2-\u6838\u5FC3\u4EE3\u7801" aria-hidden="true">#</a> 9.2.2\uFF1A\u6838\u5FC3\u4EE3\u7801</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>qf<span class="token punctuation">.</span>sentinel</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>command<span class="token punctuation">.</span>handler<span class="token punctuation">.</span></span><span class="token class-name">ModifyParamFlowRulesCommandHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>init<span class="token punctuation">.</span></span><span class="token class-name">InitFunc</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>authority<span class="token punctuation">.</span></span><span class="token class-name">AuthorityRule</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>authority<span class="token punctuation">.</span></span><span class="token class-name">AuthorityRuleManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>degrade<span class="token punctuation">.</span></span><span class="token class-name">DegradeRule</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>degrade<span class="token punctuation">.</span></span><span class="token class-name">DegradeRuleManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>flow<span class="token punctuation">.</span></span><span class="token class-name">FlowRule</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>flow<span class="token punctuation">.</span></span><span class="token class-name">FlowRuleManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>param<span class="token punctuation">.</span></span><span class="token class-name">ParamFlowRule</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span>flow<span class="token punctuation">.</span>param<span class="token punctuation">.</span></span><span class="token class-name">ParamFlowRuleManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>system<span class="token punctuation">.</span></span><span class="token class-name">SystemRule</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>system<span class="token punctuation">.</span></span><span class="token class-name">SystemRuleManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>transport<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">WritableDataSourceRegistry</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">TypeReference</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u62C9\u6A21\u5F0F\u89C4\u5219\u6301\u4E45\u5316
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileDataSourceInit</span> <span class="token keyword">implements</span> <span class="token class-name">InitFunc</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// TIPS: \u5982\u679C\u4F60\u5BF9\u8FD9\u4E2A\u8DEF\u5F84\u4E0D\u559C\u6B22\uFF0C\u53EF\u4FEE\u6539\u4E3A\u4F60\u559C\u6B22\u7684\u8DEF\u5F84</span>
        <span class="token class-name">String</span> ruleDir <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.dir&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/sentinel/rules&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> flowRulePath <span class="token operator">=</span> ruleDir <span class="token operator">+</span> <span class="token string">&quot;/flow-rule.json&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> degradeRulePath <span class="token operator">=</span> ruleDir <span class="token operator">+</span> <span class="token string">&quot;/degrade-rule.json&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> systemRulePath <span class="token operator">=</span> ruleDir <span class="token operator">+</span> <span class="token string">&quot;/system-rule.json&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> authorityRulePath <span class="token operator">=</span> ruleDir <span class="token operator">+</span> <span class="token string">&quot;/authority-rule.json&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> paramFlowRulePath <span class="token operator">=</span> ruleDir <span class="token operator">+</span> <span class="token string">&quot;/param-flow-rule.json&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mkdirIfNotExits</span><span class="token punctuation">(</span>ruleDir<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createFileIfNotExits</span><span class="token punctuation">(</span>flowRulePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createFileIfNotExits</span><span class="token punctuation">(</span>degradeRulePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createFileIfNotExits</span><span class="token punctuation">(</span>systemRulePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createFileIfNotExits</span><span class="token punctuation">(</span>authorityRulePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createFileIfNotExits</span><span class="token punctuation">(</span>paramFlowRulePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u6D41\u63A7\u89C4\u5219</span>
        <span class="token class-name">ReadableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">FlowRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> flowRuleRDS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileRefreshableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            flowRulePath<span class="token punctuation">,</span>
            flowRuleListParser
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5C06\u53EF\u8BFB\u6570\u636E\u6E90\u6CE8\u518C\u81F3FlowRuleManager</span>
        <span class="token comment">// \u8FD9\u6837\u5F53\u89C4\u5219\u6587\u4EF6\u53D1\u751F\u53D8\u5316\u65F6\uFF0C\u5C31\u4F1A\u66F4\u65B0\u89C4\u5219\u5230\u5185\u5B58</span>
        <span class="token class-name">FlowRuleManager</span><span class="token punctuation">.</span><span class="token function">register2Property</span><span class="token punctuation">(</span>flowRuleRDS<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WritableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">FlowRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> flowRuleWDS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWritableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            flowRulePath<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token operator">::</span><span class="token function">encodeJson</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// \u5C06\u53EF\u5199\u6570\u636E\u6E90\u6CE8\u518C\u81F3transport\u6A21\u5757\u7684WritableDataSourceRegistry\u4E2D</span>
        <span class="token comment">// \u8FD9\u6837\u6536\u5230\u63A7\u5236\u53F0\u63A8\u9001\u7684\u89C4\u5219\u65F6\uFF0CSentinel\u4F1A\u5148\u66F4\u65B0\u5230\u5185\u5B58\uFF0C\u7136\u540E\u5C06\u89C4\u5219\u5199\u5165\u5230\u6587\u4EF6\u4E2D</span>
        <span class="token class-name">WritableDataSourceRegistry</span><span class="token punctuation">.</span><span class="token function">registerFlowDataSource</span><span class="token punctuation">(</span>flowRuleWDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u964D\u7EA7\u89C4\u5219</span>
        <span class="token class-name">ReadableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">DegradeRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> degradeRuleRDS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileRefreshableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            degradeRulePath<span class="token punctuation">,</span>
            degradeRuleListParser
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DegradeRuleManager</span><span class="token punctuation">.</span><span class="token function">register2Property</span><span class="token punctuation">(</span>degradeRuleRDS<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WritableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">DegradeRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> degradeRuleWDS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWritableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            degradeRulePath<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token operator">::</span><span class="token function">encodeJson</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WritableDataSourceRegistry</span><span class="token punctuation">.</span><span class="token function">registerDegradeDataSource</span><span class="token punctuation">(</span>degradeRuleWDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u7CFB\u7EDF\u89C4\u5219</span>
        <span class="token class-name">ReadableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">SystemRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> systemRuleRDS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileRefreshableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            systemRulePath<span class="token punctuation">,</span>
            systemRuleListParser
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SystemRuleManager</span><span class="token punctuation">.</span><span class="token function">register2Property</span><span class="token punctuation">(</span>systemRuleRDS<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WritableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">SystemRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> systemRuleWDS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWritableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            systemRulePath<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token operator">::</span><span class="token function">encodeJson</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WritableDataSourceRegistry</span><span class="token punctuation">.</span><span class="token function">registerSystemDataSource</span><span class="token punctuation">(</span>systemRuleWDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u6388\u6743\u89C4\u5219</span>
        <span class="token class-name">ReadableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">AuthorityRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> authorityRuleRDS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileRefreshableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            authorityRulePath<span class="token punctuation">,</span>
            authorityRuleListParser
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AuthorityRuleManager</span><span class="token punctuation">.</span><span class="token function">register2Property</span><span class="token punctuation">(</span>authorityRuleRDS<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WritableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">AuthorityRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> authorityRuleWDS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWritableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            authorityRulePath<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token operator">::</span><span class="token function">encodeJson</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WritableDataSourceRegistry</span><span class="token punctuation">.</span><span class="token function">registerAuthorityDataSource</span><span class="token punctuation">(</span>authorityRuleWDS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u70ED\u70B9\u53C2\u6570\u89C4\u5219</span>
        <span class="token class-name">ReadableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">ParamFlowRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> paramFlowRuleRDS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileRefreshableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            paramFlowRulePath<span class="token punctuation">,</span>
            paramFlowRuleListParser
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ParamFlowRuleManager</span><span class="token punctuation">.</span><span class="token function">register2Property</span><span class="token punctuation">(</span>paramFlowRuleRDS<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WritableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">ParamFlowRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> paramFlowRuleWDS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWritableDataSource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            paramFlowRulePath<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token operator">::</span><span class="token function">encodeJson</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ModifyParamFlowRulesCommandHandler</span><span class="token punctuation">.</span><span class="token function">setWritableDataSource</span><span class="token punctuation">(</span>paramFlowRuleWDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">FlowRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> flowRuleListParser <span class="token operator">=</span> source <span class="token operator">-&gt;</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>
        source<span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">FlowRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">DegradeRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> degradeRuleListParser <span class="token operator">=</span> source <span class="token operator">-&gt;</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>
        source<span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">DegradeRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">SystemRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> systemRuleListParser <span class="token operator">=</span> source <span class="token operator">-&gt;</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>
        source<span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">SystemRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">AuthorityRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> authorityRuleListParser <span class="token operator">=</span> source <span class="token operator">-&gt;</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>
        source<span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">AuthorityRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">ParamFlowRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> paramFlowRuleListParser <span class="token operator">=</span> source <span class="token operator">-&gt;</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>
        source<span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">ParamFlowRule</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">mkdirIfNotExits</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            file<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">createFileIfNotExits</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            file<span class="token punctuation">.</span><span class="token function">createNewFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">String</span> <span class="token function">encodeJson</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+B+'" alt="image-20201028204618786"></p><p><img src="'+J+`" alt="image-20201028210839167"></p><h3 id="_9-2-3-\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_9-2-3-\u914D\u7F6E" aria-hidden="true">#</a> 9.2.3\uFF1A\u914D\u7F6E</h3><p>\u5728\u9879\u76EE\u7684 <code>resources/META-INF/services</code> \u76EE\u5F55\u4E0B\u521B\u5EFA\u6587\u4EF6\uFF0C</p><p>\u6587\u4EF6\u540D\uFF1A com.alibaba.csp.sentinel.init.InitFunc</p><p>\u5185\u5BB9\u4E3A\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># \u6539\u6210\u4E0A\u9762FileDataSourceInit\u7684\u5305\u540D\u7C7B\u540D\u5168\u8DEF\u5F84\u5373\u53EF\u3002
com.wfx.config.FileDataSourceInit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-4-\u4F18\u7F3A\u70B9\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_9-2-4-\u4F18\u7F3A\u70B9\u5206\u6790" aria-hidden="true">#</a> 9.2.4\uFF1A\u4F18\u7F3A\u70B9\u5206\u6790</h3><ul><li>\u4F18\u70B9 <ul><li>\u7B80\u5355\u6613\u61C2</li><li>\u6CA1\u6709\u591A\u4F59\u4F9D\u8D56\uFF08\u6BD4\u5982\u914D\u7F6E\u4E2D\u5FC3\u3001\u7F13\u5B58\u7B49\uFF09</li></ul></li><li>\u7F3A\u70B9 <ul><li>\u7531\u4E8E\u89C4\u5219\u662F\u7528 FileRefreshableDataSource \u5B9A\u65F6\u66F4\u65B0\u7684\uFF0C\u6240\u4EE5\u89C4\u5219\u66F4\u65B0\u4F1A\u6709\u5EF6\u8FDF\u3002\u5982\u679CFileRefreshableDataSource\u5B9A\u65F6\u65F6\u95F4\u8FC7\u5927\uFF0C\u53EF\u80FD\u957F\u65F6\u95F4\u5EF6\u8FDF\uFF1B\u5982\u679CFileRefreshableDataSource\u8FC7\u5C0F\uFF0C\u53C8\u4F1A\u5F71\u54CD\u6027\u80FD\uFF1B</li><li>\u89C4\u5219\u5B58\u50A8\u5728\u672C\u5730\u6587\u4EF6\uFF0C\u5982\u679C\u6709\u4E00\u5929\u9700\u8981\u8FC1\u79FB\u5FAE\u670D\u52A1\uFF0C\u90A3\u4E48\u9700\u8981\u628A\u89C4\u5219\u6587\u4EF6\u4E00\u8D77\u8FC1\u79FB\uFF0C\u5426\u5219\u89C4\u5219\u4F1A\u4E22\u5931\u3002</li></ul></li></ul><h2 id="_9-3-push\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_9-3-push\u6A21\u5F0F" aria-hidden="true">#</a> 9.3\uFF1APush\u6A21\u5F0F</h2><p>\u751F\u4EA7\u73AF\u5883\u4E0B\u4E00\u822C\u66F4\u5E38\u7528\u7684\u662F push \u6A21\u5F0F\u7684\u6570\u636E\u6E90\u3002\u5BF9\u4E8E push \u6A21\u5F0F\u7684\u6570\u636E\u6E90,\u5982\u8FDC\u7A0B\u914D\u7F6E\u4E2D\u5FC3\uFF08ZooKeeper, Nacos, Apollo\u7B49\u7B49\uFF09\uFF0C\u63A8\u9001\u7684\u64CD\u4F5C\u4E0D\u5E94\u7531 Sentinel \u5BA2\u6237\u7AEF\u8FDB\u884C\uFF0C\u800C\u5E94\u8BE5\u7ECF\u63A7\u5236\u53F0\u7EDF\u4E00\u8FDB\u884C\u7BA1\u7406\uFF0C\u76F4\u63A5\u8FDB\u884C\u63A8\u9001\uFF0C\u6570\u636E\u6E90\u4EC5\u8D1F\u8D23\u83B7\u53D6\u914D\u7F6E\u4E2D\u5FC3\u63A8\u9001\u7684\u914D\u7F6E\u5E76\u66F4\u65B0\u5230\u672C\u5730\u3002\u56E0\u6B64\u63A8\u9001\u89C4\u5219\u6B63\u786E\u505A\u6CD5\u5E94\u8BE5\u662F <strong>\u914D\u7F6E\u4E2D\u5FC3\u63A7\u5236\u53F0/Sentinel \u63A7\u5236\u53F0 \u2192 \u914D\u7F6E\u4E2D\u5FC3 \u2192 Sentinel \u6570\u636E\u6E90 \u2192 Sentinel</strong>\uFF0C\u800C\u4E0D\u662F\u7ECF Sentinel \u6570\u636E\u6E90\u63A8\u9001\u81F3\u914D\u7F6E\u4E2D\u5FC3\u3002\u8FD9\u6837\u7684\u6D41\u7A0B\u5C31\u975E\u5E38\u6E05\u6670\u4E86\uFF1A</p>`,84),Z=s("h3",{id:"_9-3-1-\u63A7\u5236\u53F0\u6539\u9020",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_9-3-1-\u63A7\u5236\u53F0\u6539\u9020","aria-hidden":"true"},"#"),n(" 9.3.1\uFF1A\u63A7\u5236\u53F0\u6539\u9020")],-1),X=s("p",null,"\u61D2\u4EBA\u5305",-1),Y=a(`<h3 id="_9-3-2-\u5FAE\u670D\u52A1\u7AEF" tabindex="-1"><a class="header-anchor" href="#_9-3-2-\u5FAE\u670D\u52A1\u7AEF" aria-hidden="true">#</a> 9.3.2\uFF1A\u5FAE\u670D\u52A1\u7AEF</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- sentinel --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- sentinel\u7684nacos\u6301\u4E45\u5316 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-datasource-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-3-3-\u6DFB\u52A0\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_9-3-3-\u6DFB\u52A0\u914D\u7F6E" aria-hidden="true">#</a> 9.3.3\uFF1A\u6DFB\u52A0\u914D\u7F6E</h3><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">spring</span><span class="token punctuation">:</span>
<span class="token key attr-name">  cloud</span><span class="token punctuation">:</span>
<span class="token key attr-name">    sentinel</span><span class="token punctuation">:</span>
<span class="token key attr-name">      transport</span><span class="token punctuation">:</span>
<span class="token key attr-name">        port</span><span class="token punctuation">:</span> <span class="token value attr-value">8721</span>
<span class="token key attr-name">        dashboard</span><span class="token punctuation">:</span> <span class="token value attr-value">localhost:8888</span>
<span class="token key attr-name">      eager</span><span class="token punctuation">:</span> <span class="token value attr-value">true #\u9965\u997F\u52A0\u8F7D</span>
<span class="token key attr-name">      web-context-unify</span><span class="token punctuation">:</span> <span class="token value attr-value">false</span>
<span class="token key attr-name">      datasource</span><span class="token punctuation">:</span>
<span class="token key attr-name">        flow</span><span class="token punctuation">:</span>
<span class="token key attr-name">          nacos</span><span class="token punctuation">:</span>
<span class="token key attr-name">            server-addr</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.server-addr}</span>
<span class="token key attr-name">            username</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.username}</span>
<span class="token key attr-name">            password</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.password}</span>
<span class="token key attr-name">            namespace</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.namespace}</span>
<span class="token key attr-name">            groupId</span><span class="token punctuation">:</span> <span class="token value attr-value">SENTINEL_GROUP</span>
<span class="token key attr-name">            dataId</span><span class="token punctuation">:</span> <span class="token value attr-value">\${spring.application.name}-flow-rules</span>
<span class="token key attr-name">            rule-type</span><span class="token punctuation">:</span> <span class="token value attr-value">flow</span>
<span class="token key attr-name">        degrade</span><span class="token punctuation">:</span>
<span class="token key attr-name">          nacos</span><span class="token punctuation">:</span>
<span class="token key attr-name">            server-addr</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.server-addr}</span>
<span class="token key attr-name">            username</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.username}</span>
<span class="token key attr-name">            password</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.password}</span>
<span class="token key attr-name">            namespace</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.namespace}</span>
<span class="token key attr-name">            groupId</span><span class="token punctuation">:</span> <span class="token value attr-value">SENTINEL_GROUP</span>
<span class="token key attr-name">            dataId</span><span class="token punctuation">:</span> <span class="token value attr-value">\${spring.application.name}-degrade-rules</span>
<span class="token key attr-name">            rule-type</span><span class="token punctuation">:</span> <span class="token value attr-value">degrade</span>
<span class="token key attr-name">        param-flow</span><span class="token punctuation">:</span>
<span class="token key attr-name">          nacos</span><span class="token punctuation">:</span>
<span class="token key attr-name">            server-addr</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.server-addr}</span>
<span class="token key attr-name">            username</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.username}</span>
<span class="token key attr-name">            password</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.password}</span>
<span class="token key attr-name">            namespace</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.namespace}</span>
<span class="token key attr-name">            groupId</span><span class="token punctuation">:</span> <span class="token value attr-value">SENTINEL_GROUP</span>
<span class="token key attr-name">            dataId</span><span class="token punctuation">:</span> <span class="token value attr-value">\${spring.application.name}-param-rules</span>
<span class="token key attr-name">            rule-type</span><span class="token punctuation">:</span> <span class="token value attr-value">param-flow</span>
<span class="token key attr-name">        system</span><span class="token punctuation">:</span>
<span class="token key attr-name">          nacos</span><span class="token punctuation">:</span>
<span class="token key attr-name">            server-addr</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.server-addr}</span>
<span class="token key attr-name">            username</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.username}</span>
<span class="token key attr-name">            password</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.password}</span>
<span class="token key attr-name">            namespace</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.namespace}</span>
<span class="token key attr-name">            groupId</span><span class="token punctuation">:</span> <span class="token value attr-value">SENTINEL_GROUP</span>
<span class="token key attr-name">            dataId</span><span class="token punctuation">:</span> <span class="token value attr-value">\${spring.application.name}-system-rules</span>
<span class="token key attr-name">            rule-type</span><span class="token punctuation">:</span> <span class="token value attr-value">system</span>
<span class="token key attr-name">        authority</span><span class="token punctuation">:</span>
<span class="token key attr-name">          nacos</span><span class="token punctuation">:</span>
<span class="token key attr-name">            server-addr</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.server-addr}</span>
<span class="token key attr-name">            username</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.username}</span>
<span class="token key attr-name">            password</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.password}</span>
<span class="token key attr-name">            namespace</span><span class="token punctuation">:</span> <span class="token value attr-value">\${nacos.namespace}</span>
<span class="token key attr-name">            groupId</span><span class="token punctuation">:</span> <span class="token value attr-value">SENTINEL_GROUP</span>
<span class="token key attr-name">            dataId</span><span class="token punctuation">:</span> <span class="token value attr-value">\${spring.application.name}-authority-rules</span>
<span class="token key attr-name">            rule-type</span><span class="token punctuation">:</span> <span class="token value attr-value">authority</span>
<span class="token key attr-name">nacos</span><span class="token punctuation">:</span>
<span class="token key attr-name">  server-addr</span><span class="token punctuation">:</span> <span class="token value attr-value">localhost:8848</span>
<span class="token key attr-name">  username</span><span class="token punctuation">:</span> <span class="token value attr-value">nacos</span>
<span class="token key attr-name">  password</span><span class="token punctuation">:</span> <span class="token value attr-value">nacos</span>
<span class="token key attr-name">  namespace</span><span class="token punctuation">:</span> <span class="token value attr-value">sentinel</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4);function nn(sn,an){const t=o("ExternalLinkIcon");return l(),i("div",null,[U,s("p",null,[n("\u5300\u901F\u6392\u961F\uFF08"),V,n("\uFF09\u65B9\u5F0F\u4F1A\u4E25\u683C\u63A7\u5236\u8BF7\u6C42\u901A\u8FC7\u7684\u95F4\u9694\u65F6\u95F4\uFF0C\u4E5F\u5373\u662F\u8BA9\u8BF7\u6C42\u4EE5\u5747\u5300\u7684\u901F\u5EA6\u901A\u8FC7\uFF0C\u5BF9\u5E94\u7684\u662F\u6F0F\u6876\u7B97\u6CD5\u3002\u8BE6\u7EC6\u6587\u6863\u53EF\u4EE5\u53C2\u8003 "),s("a",G,[n("\u6D41\u91CF\u63A7\u5236 - \u5300\u901F\u5668\u6A21\u5F0F"),e(t)]),n("\uFF0C\u5177\u4F53\u7684\u4F8B\u5B50\u53EF\u4EE5\u53C2\u89C1 "),s("a",z,[n("PaceFlowDemo"),e(t)]),n("\u3002")]),K,p(" ![image-20211009094301650](./_pic/image-20211009094301650.png) "),Z,X,p(" ![image-20210824151803313](./_pic/image-20210824151803313.png) "),Y])}const en=c(Q,[["render",nn],["__file","03_Sentinel.html.vue"]]);export{en as default};
